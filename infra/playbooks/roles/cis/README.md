# noo Ansible Role: CIS Benchmark for Debian 12

This role implements the CIS Benchmark for Debian 12. It performs a large number
of security checks and configurations to bring the system in line with the CIS
Benchmarks.

## GRUB password

One of the requirements is to protect the GRUB bootloader from unauthorized
changes at boot time. This is done by setting a password for the GRUB
bootloader. The password is stored (hashed) in the `grub_password` variable in
the `defaults/main.yml`. There's no scenario where this password is actually
used, but it's stored in our vault for safekeeping.

## Not implemented

### 1.1.2.[3-7] Configure {/home, /var, /var/tmp, /var/log, /var/log/audit}

The Benchmark requires separate partitions for /home, /var, /var/tmp, /var/log,
and /var/log/audit. I do not believe this can be done at all in an ansible role
running on a live system. Hetzner provides us with a single, GPT formatted disk
with an ext4 root partition. Implementing the above would require:
- shrinking the filesystem while the system is running (which is not
  possible)
- shrinking the partition
- creating new partitions
- creating filesystems on the new partitions
- mounting the new filesystems on temporary mount points
- copying the data from the old directories to the new filesystems
- unmounting the new filesystems
- remounting the new filesystems on the original mount points
- plenty of luck.

### 4.2.7 Ensure ufw default deny firewall policy

The use of a host firewall is recommended, with a default deny policy for all
inbound, outbound, and routing traffic.

A default deny is implemented for inbound and routing traffic, but not for
outbound traffic. Implementing this would be a significant undertaking for very
little gain. There would be need to add IP rules for anything that needs to
connect to the outside world, including:
- apt
- docker image registry
- s3
- any third party APIs.

And most of these services don't publish or don't have stable IP addresses.

At some point we may want to implement an outbound firewall / proxy that can
work with dynamic IP addresses, but for now there is no need for this.

### 5.1.2/3 Ensure permissions on SSH {private, public} host key files are configured

These files MUST be deleted and re-generated by cloud-init. Having the role
check and fix the permissions on these files would be pointless.

### 5.1.5 Ensure sshd Banner is configured

We rely on the update-motd mechanism to display a banner.

### 5.3.2.3/4 Ensure pam_pwquality / pam_pwhistory module is enabled
### 5.3.3.2 Configure pam_pwquality module
### 5.4.1.1 Ensure password expiration is configured
### 5.4.1.2 Ensure minimum password days is configured
### 5.4.1.3 Ensure password expiration warning days is configured
### 5.4.1.5 Ensure inactive password lock is configured

We do not give out unix accounts to our users. There is only one noo-admin user
configured for emergency access. Its password is securely long and complex and
stored in a password manager and not changed often.

We have decided not to implement this part of the benchmark. We might revisit
this decision in the future.

### Chapter 6 on audit and logging

This is only partially implemented and needs more work. Auditd and aide are
installed, but the configuration has not been checked against the benchmark.